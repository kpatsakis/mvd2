struct dvb_frontend *xc2028_attach(struct dvb_frontend struct xc2028_config *cfg) struct xc2028_data * priv ; int instance ; if ( NULL == cfg )  if ( ! fe )  instance = hybrid_tuner_request_state ( struct xc2028_data , priv hybrid_tuner_instance_list cfg -> i2c_adap , cfg -> i2c_addr "xc2028" ) switch ( instance )  priv -> ctrl . max_len = 13; fe -> tuner_priv = priv; fe -> tuner_priv = priv; if ( cfg -> ctrl )  xc2028_set_config ( fe , cfg -> ctrl ); static int xc2028_set_config(struct dvb_frontend *fe, void *priv_cfg) struct xc2028_data * priv = fe -> tuner_priv ; struct xc2028_ctrl * p = priv_cfg ; memcpy ( & priv -> ctrl , p , sizeof ( priv -> ctrl ) ); priv -> ctrl . fname = kstrdup ( p -> fname , GFP_KERNEL ); if ( priv -> ctrl . fname == NULL )  if ( ! firmware_name [ 0 ] && p -> fname && priv -> fname && strcmp ( p -> fname , priv -> fname ) )  free_firmware ( priv ); static void free_firmware(struct xc2028_data *priv) if ( ! priv -> firm )  for (i = 0; i < priv->firm_size; i++) kfree ( priv -> firm [ i ] . ptr ); kfree ( priv -> firm ); priv -> firm = NULL; priv -> firm_size = 0; priv -> state = XC2028_NO_FIRMWARE; memset ( & priv -> cur_fw , 0 , sizeof ( priv -> cur_fw ) ); if ( priv -> ctrl . max_len < 9 )  priv -> ctrl . max_len = 13; if ( priv -> state == XC2028_NO_FIRMWARE )  priv -> fname = priv -> ctrl . fname; rc = request_firmware_nowait ( THIS_MODULE , 1 , priv -> fname , priv -> i2c_props . adap -> dev . parent , GFP_KERNEL , fe , load_firmware_cb ); if ( rc < 0 )  tuner_err ( "Failed to request firmware %s\n" , priv -> fname ); return rc ; 