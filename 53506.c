static int jpeg2000_decode_frame(AVCodecContext *avctx, void int *got_frame, AVPacket *avpkt) Jpeg2000DecoderContext * s = avctx -> priv_data ; int tileno , ret ; s -> avctx = avctx; s -> curtileno = - 1; memset ( s -> cdef , - 1 , sizeof ( s -> cdef ) ); if ( bytestream2_get_bytes_left ( & s -> g ) < 2 )  if ( bytestream2_get_bytes_left ( & s -> g ) >= 12 && ( bytestream2_get_be32u ( & s -> g ) == 12 ) && ( bytestream2_get_be32u ( & s -> g ) == JP2_SIG_TYPE ) && ( bytestream2_get_be32u ( & s -> g ) == JP2_SIG_VALUE ) )  if ( ! jp2_find_codestream ( s ) )  if ( bytestream2_get_be16u ( & s -> g ) != JPEG2000_SOC )  if ( ret = jpeg2000_read_main_headers ( s ) )  static int jpeg2000_read_main_headers(Jpeg2000DecoderContext *s) Jpeg2000CodingStyle * codsty = s -> codsty ; Jpeg2000QuantStyle * qntsty = s -> qntsty ; Jpeg2000POC * poc = & s -> poc ; uint8_t * properties = s -> properties ; int len , ret = 0 ; uint16_t marker ; int oldpos ; if ( bytestream2_get_bytes_left ( & s -> g ) < 2 )  marker = bytestream2_get_be16u ( & s -> g ); oldpos = bytestream2_tell ( & s -> g ); if ( marker == JPEG2000_SOD )  Jpeg2000Tile * tile ; Jpeg2000TilePart * tp ; if ( ! s -> tile )  if ( s -> curtileno < 0 )  tile = s -> tile + s -> curtileno; tp = tile -> tile_part + tile -> tp_idx; if ( tp -> tp_end < s -> g . buffer )  if ( marker == JPEG2000_EOC )  len = bytestream2_get_be16 ( & s -> g ); if ( len < 2 || bytestream2_get_bytes_left ( & s -> g ) < len - 2 )  switch ( marker )  ret = get_siz ( s ); if ( ! s -> tile )  s -> numXtiles = s -> numYtiles = 0; ret = get_coc ( s , codsty , properties ); ret = get_cod ( s , codsty , properties ); ret = get_qcc ( s , len , qntsty , properties ); ret = get_qcd ( s , len , qntsty , properties ); ret = get_poc ( s , len , poc ); if ( ! ( ret = get_sot ( s , len ) ) )  codsty = s -> tile [ s -> curtileno ] . codsty; qntsty = s -> tile [ s -> curtileno ] . qntsty; poc = & s -> tile [ s -> curtileno ] . poc; properties = s -> tile [ s -> curtileno ] . properties; ret = get_tlm ( s , len ); ret = get_plt ( s , len ); if ( bytestream2_tell ( & s -> g ) - oldpos != len || ret )  static int get_coc(Jpeg2000DecoderContext *s, Jpeg2000CodingStyle uint8_t *properties) int compno , ret ; if ( bytestream2_get_bytes_left ( & s -> g ) < 2 )  compno = bytestream2_get_byteu ( & s -> g ); if ( compno >= s -> ncomponents )  c += compno; c -> csty = bytestream2_get_byteu ( & s -> g ); if ( ( ret = get_cox ( s , c ) ) < 0 )  static int get_cox(Jpeg2000DecoderContext *s, Jpeg2000CodingStyle *c) if ( bytestream2_get_bytes_left ( & s -> g ) < 5 )  c -> nreslevels = bytestream2_get_byteu ( & s -> g ) + 1; if ( c -> nreslevels >= JPEG2000_MAX_RESLEVELS )  if ( c -> nreslevels <= s -> reduction_factor )  c -> nreslevels2decode = c -> nreslevels - s -> reduction_factor; c -> log2_cblk_width = ( bytestream2_get_byteu ( & s -> g ) & 15 ) + 2; c -> log2_cblk_height = ( bytestream2_get_byteu ( & s -> g ) & 15 ) + 2; if ( c -> log2_cblk_width > 10 || c -> log2_cblk_height > 10 || c -> log2_cblk_width + c -> log2_cblk_height > 12 )  c -> cblk_style = bytestream2_get_byteu ( & s -> g ); c -> transform = bytestream2_get_byteu ( & s -> g ); if ( ( s -> avctx -> flags & AV_CODEC_FLAG_BITEXACT ) && ( c -> transform == FF_DWT97 ) )  c -> transform = FF_DWT97_INT; if ( c -> csty & JPEG2000_CSTY_PREC )  memset ( c -> log2_prec_widths , 15 , sizeof ( c -> log2_prec_widths ) ); memset ( c -> log2_prec_heights , 15 , sizeof ( c -> log2_prec_heights ) ); 