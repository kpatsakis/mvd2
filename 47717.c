static dissect_iax2(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree) proto_item * iax2_item ; proto_tree * iax2_tree ; guint32 offset = 0 , len ; guint16 scallno = 0 ; guint16 stmp ; packet_type type ; proto_item * full_mini_base ; iax2_item = proto_tree_add_item ( tree , proto_iax2 , tvb , offset , - 1 , ENC_NA ); iax2_tree = proto_item_add_subtree ( iax2_item , ett_iax2 ); stmp = tvb_get_ntohs ( tvb , offset ); if ( stmp == 0 )  offset += 2; stmp = tvb_get_ntohs ( tvb , offset ); if ( stmp & 0x8000 )  type = IAX2_MINI_VIDEO_PACKET; scallno = stmp & 0x7FFF; offset += 2; type = IAX2_TRUNK_PACKET; scallno = tvb_get_ntohs ( tvb , offset ); offset += 2; if ( scallno & 0x8000 )  type = IAX2_FULL_PACKET; type = IAX2_MINI_VOICE_PACKET; scallno &= 0x7FFF; full_mini_base = proto_tree_add_uint ( iax2_tree , hf_iax2_packet_type , tvb , 0 , offset , type ); full_mini_subtree = proto_item_add_subtree ( full_mini_base , ett_iax2_full_mini_subtree ); switch ( type )  len = dissect_minipacket ( tvb , offset , scallno , pinfo , full_mini_subtree , tree ); static guint32 dissect_minipacket(tvbuff_t *tvb, guint32 offset, guint16 packet_info *pinfo, proto_tree proto_tree *main_tree) guint32 ts ; iax_packet_data * iax_packet ; ts = tvb_get_ntohs ( tvb , offset ); iax_packet = iax2_get_packet_data_for_minipacket ( pinfo , scallno , FALSE ); static iax_packet_data *iax2_get_packet_data_for_minipacket(packet_info guint16 gboolean video) iax_packet_data * p = ( iax_packet_data * ) p_get_proto_data ( wmem_file_scope ( ) , pinfo , proto_iax2 , 0 ) ; if ( ! p )  gboolean reversed ; iax_call_data * iax_call ; iax_call = iax_lookup_call ( pinfo , scallno , 0 , & reversed ); p = iax_new_packet_data ( iax_call , reversed ); if ( iax_call )  if ( video )  p -> codec = reversed ? iax_call -> dst_codec : iax_call -> src_codec; return p ; offset += 2; dissect_payload ( tvb , offset , pinfo , iax2_tree , main_tree , ts , FALSE , iax_packet ); static void dissect_payload(tvbuff_t *tvb, guint32 packet_info *pinfo, proto_tree proto_tree *tree, guint32 ts _U_, gboolean iax_packet_data *iax_packet) tvbuff_t * sub_tvb ; if ( offset >= tvb_reported_length ( tvb ) )  sub_tvb = tvb_new_subset_remaining ( tvb , offset ); if ( iax_packet -> call_data )  process_iax_pdu ( sub_tvb , pinfo , tree , video , iax_packet ); static void process_iax_pdu(tvbuff_t *tvb, packet_info *pinfo, proto_tree gboolean video, iax_packet_data *iax_packet) iax_call_data * iax_call = iax_packet -> call_data ; if ( ! video && iax_call && iax_call -> subdissector )  iax2_dissector_info_t dissector_info ; if ( iax_packet -> call_data == NULL )  memset ( & dissector_info , 0 , sizeof ( dissector_info ) ); 