 CVE_2013_1673_PATCHED_FixServicePath(SC_HANDLE LPCWSTR BOOL &servicePathWasWrong) bool doesServiceHaveCorrectPath currentServicePathLen > 2 ! wcsstr ( currentServicePath , L "maintenanceservice_tmp.exe" ) currentServicePath [ 0 ] == L '\"' currentServicePath [ currentServicePathLen - 1 ] == L '\"' if ( doesServiceHaveCorrectPath )  WCHAR fixedPath [ MAX_PATH + 1 ] = L '\0' wcsncpy ( fixedPath , currentServicePath , MAX_PATH ); PathUnquoteSpacesW ( fixedPath ); if ( ! PathRemoveFileSpecW ( fixedPath ) )  if ( ! PathAppendSafe ( fixedPath , L "maintenanceservice.exe" ) ) if ( ! ChangeServiceConfigW ( service , SERVICE_NO_CHANGE , SERVICE_NO_CHANGE , SERVICE_NO_CHANGE , fixedPath , NULL , NULL , NULL , NULL , NULL , NULL ) )  LOG ( ( "Fixed service path to: %ls." , fixedPath ) ); 