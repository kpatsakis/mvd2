NS_METHOD CVE_2008_0420_PATCHED_nsBMPDecoder::ProcessData(const char* aBuffer, PRUint32 aCount) if ( ! aCount || ! mCurLine )  if ( mPos < BFH_LENGTH )  PRUint32 toCopy = BFH_LENGTH - mPos ; if ( toCopy > aCount )  toCopy = aCount; mPos += toCopy; aCount -= toCopy; if ( mPos == BFH_LENGTH )  if ( mBFH . signature [ 0 ] != 'B' || mBFH . signature [ 1 ] != 'M' )  if ( mBFH . bihsize == OS2_BIH_LENGTH )  mLOH = OS2_HEADER_LENGTH; if ( mPos >= BFH_LENGTH && mPos < mLOH )  PRUint32 toCopy = mLOH - mPos ; if ( toCopy > aCount )  toCopy = aCount; mPos += toCopy; if ( mPos == mLOH )  if ( mBIH . bpp != 1 && mBIH . bpp != 4 && mBIH . bpp != 8 && mBIH . bpp != 16 && mBIH . bpp != 24 && mBIH . bpp != 32 )  if ( mBIH . bpp <= 8 )  mColors = new colorTable [ 256 ]; if ( ! mColors )  memset ( mColors , 0 , 256 * sizeof ( colorTable ) ); if ( mColors && ( mPos >= mLOH && ( mPos < ( mLOH + mNumColors * bpc ) ) ) )  mColors [ colorNum ] . blue = * aBuffer; mColors [ colorNum ] . green = * aBuffer; mColors [ colorNum ] . red = * aBuffer; colorNum ++; SetPixel ( d , idx , mColors ); Set4BitPixel ( d , * p , lpos , mColors ); SetPixel ( d , * p , mColors ); SetPixel ( mDecoding , byte , mColors ); Set4BitPixel ( mDecoding , byte , mStateData , mColors ); SetPixel ( mDecoding , byte , mColors ); Set4BitPixel ( mDecoding , byte , mStateData , mColors ); 