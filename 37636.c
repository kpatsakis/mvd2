static CVE_2015_1158_PATCHED_print_job(cupsd_client_t  *con,		/* I - Client connection ipp_attribute_t *uri)		/* I - Printer URI */ ipp_attribute_t * attr ; ipp_attribute_t * format ; const char * default_format ; char super [ MIME_MAX_SUPER ] , type [ MIME_MAX_TYPE ] , mimetype [ MIME_MAX_SUPER + MIME_MAX_TYPE + 2 ] ; cupsd_printer_t * printer ; if ( ( attr = ippFindAttribute ( con -> request , "compression" , IPP_TAG_KEYWORD ) ) != NULL )  if ( ! con -> filename )  if ( ! cupsdValidateDest ( uri -> values [ 0 ] . string . text , NULL , & printer ) )  if ( ( format = ippFindAttribute ( con -> request , "document-format" , IPP_TAG_MIMETYPE ) ) != NULL )  if ( ( default_format = cupsGetOption ( "document-format" , printer -> num_options , printer -> options ) ) != NULL )  if ( sscanf ( default_format , "%15[^/]/%255[^;]" , super , type ) != 2 )  if ( ! strcmp ( super , "application" ) && ! strcmp ( type , "octet-stream" ) )  filetype = mimeType ( MimeDatabase , super , type ); cupsdLogMessage ( CUPSD_LOG_INFO , "[Job ???] Request file type is %s/%s." , filetype -> super , filetype -> type ); filetype = mimeType ( MimeDatabase , super , type ); if ( filetype && ( ! format || ( ! strcmp ( super , "application" ) && ! strcmp ( type , "octet-stream" ) ) ) )  snprintf ( mimetype , sizeof ( mimetype ) , "%s/%s" , filetype -> super , filetype -> type ); ippSetString ( con -> request , & format , 0 , mimetype ); ippAddString ( con -> request , IPP_TAG_JOB , IPP_TAG_MIMETYPE , "document-format" , NULL , mimetype ); if ( ! filetype )  if ( ! _cups_strcasecmp ( filetype -> super , "application" ) && ( ! _cups_strcasecmp ( filetype -> type , "postscript" ) || ! _cups_strcasecmp ( filetype -> type , "pdf" ) ) )  if ( ( job = add_job ( con , printer , filetype ) ) == NULL )  cupsdUpdateQuota ( printer , job -> username , 0 , kbytes ); job -> koctets += kbytes; if ( ( attr = ippFindAttribute ( job -> attrs , "job-k-octets" , IPP_TAG_INTEGER ) ) != NULL )  attr -> values [ 0 ] . integer += kbytes; if ( add_file ( con , job , filetype , compression ) )  snprintf ( filename , sizeof ( filename ) , "%s/d%05d-%03d" , RequestRoot , job -> id , job -> num_files ); rename ( con -> filename , filename ); if ( cupsdTimeoutJob ( job ) )  cupsdLogJob ( job , CUPSD_LOG_INFO , "File of type %s/%s queued by \"%s\"." , filetype -> super , filetype -> type , job -> username ); cupsdLogJob ( job , CUPSD_LOG_DEBUG , "hold_until=%d" , ( int ) job -> hold_until ); cupsdLogJob ( job , CUPSD_LOG_INFO , "Queued on \"%s\" by \"%s\"." , job -> dest , job -> username ); 