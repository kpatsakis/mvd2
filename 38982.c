static int sctp_getsockopt(struct sock *sk, int level, int char __user *optval, int __user *optlen) int len ; if ( level != SOL_SCTP )  if ( get_user ( len , optlen ) )  if ( len < 0 )  switch ( optname )  retval = sctp_getsockopt_primary_addr ( sk , len , optval , optlen ); static int sctp_getsockopt_primary_addr(struct sock *sk, int char __user *optval, int __user *optlen) struct sctp_prim prim ; struct sctp_association * asoc ; if ( len < sizeof ( struct sctp_prim ) )  len = sizeof ( struct sctp_prim ); if ( copy_from_user ( & prim , optval , len ) )  asoc = sctp_id2assoc ( sk , prim . ssp_assoc_id ); struct sctp_association *sctp_id2assoc(struct sock *sk, sctp_assoc_t id) struct sctp_association * asoc = NULL ; if ( ! sctp_style ( sk , UDP ) )  if ( ! sctp_sstate ( sk , ESTABLISHED ) && ! sctp_sstate ( sk , CLOSING ) )  return NULL ; return asoc ; if ( ! id || ( id == ( sctp_assoc_t ) - 1 ) )  return NULL ; asoc = ( struct sctp_association * ) idr_find ( & sctp_assocs_id , ( int ) id ); if ( ! asoc || ( asoc -> base . sk != sk ) || asoc -> base . dead )  return NULL ; return asoc ; if ( ! asoc )  if ( ! asoc -> peer . primary_path )  memcpy ( & prim . ssp_addr , & asoc -> peer . primary_path -> ipaddr , asoc -> peer . primary_path -> af_specific -> sockaddr_len ); sctp_get_pf_specific ( sk -> sk_family ) -> addr_to_user ( sp , ( union sctp_addr * ) & prim . ssp_addr ); if ( copy_to_user ( optval , & prim , len ) )  